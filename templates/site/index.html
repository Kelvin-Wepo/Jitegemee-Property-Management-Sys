{% extends 'base.html' %} 
{% load static %} 
{% block content %}

<!-- Showcase -->
<section id="showcase">
  <div class="container text-center">
    <div class="home-search p-5">
      <div class="overlay p-5">
        <h1 class="display-4 mb-4">Property Searching Just Got So Easy</h1>
        <p class="lead">
          Lorem ipsum dolor sit, amet consectetur adipisicing elit. Recusandae
          quas, asperiores eveniet vel nostrum magnam voluptatum tempore!
          Consectetur, id commodi!
        </p>
        <div class="search">
          <form method="GET" action="{% url 'searchapp:search' %}">
            <!-- Form Row 1 -->
            <div class="form-row">
              <div class="col-md-4 mb-3">
                <label class="sr-only">Keywords</label>
                <input
                  type="text"
                  name="keywords"
                  class="form-control"
                  placeholder="Keyword (Pool, Garage, etc)"
                />
              </div>

              <div class="col-md-4 mb-3">
                <label class="sr-only">City</label>
                <input
                  type="text"
                  name="city"
                  class="form-control"
                  placeholder="City"
                />
              </div>

              <div class="col-md-4 mb-3">
                <label class="sr-only">County</label>
                <select name="state" class="form-control">
                  <option selected="true" disabled="disabled">
                    County (All)
                  </option>
                  <option value="Baringo">Baringo</option>
                  <option value="Bomet">Bomet</option>
                  <option value="Bungoma">Bungoma</option>
                  <option value="Busia">Busia</option>
                  <option value="Elgeyo Marakwet">Elgeyo Marakwet</option>
                  <option value="Embu">Embu</option>
                  <option value="Garissa">Garissa</option>
                  <option value="Homa Bay">Homa Bay</option>
                  <option value="Isiolo">Isiolo</option>
                  <option value="Kajiado">Kajiado</option>
                  <option value="Kakamega">Kakamega</option>
                  <option value="Kericho">Kericho</option>
                  <option value="Kiambu">Kiambu</option>
                  <option value="Kilifi">Kilifi</option>
                  <option value="Kirinyaga">Kirinyaga</option>
                  <option value="Kisii">Kisii</option>
                  <option value="Kisumu">Kisumu</option>
                  <option value="Kitui">Kitui</option>
                  <option value="Kwale">Kwale</option>
                  <option value="Laikipia">Laikipia</option>
                  <option value="Lamu">Lamu</option>
                  <option value="Machakos">Machakos</option>
                  <option value="Makueni">Makueni</option>
                  <option value="Mandera">Mandera</option>
                  <option value="Marsabit">Marsabit</option>
                  <option value="Meru">Meru</option>
                  <option value="Migori">Migori</option>
                  <option value="Mombasa">Mombasa</option>
                  <option value="Murang'a">Murang'a</option>
                  <option value="Nairobi City">Nairobi City</option>
                  <option value="Nakuru">Nakuru</option>
                  <option value="Nandi">Nandi</option>
                  <option value="Narok">Narok</option>
                  <option value="Nyamira">Nyamira</option>
                  <option value="Nyandarua">Nyandarua</option>
                  <option value="Nyeri">Nyeri</option>
                  <option value="Samburu">Samburu</option>
                  <option value="Siaya">Siaya</option>
                  <option value="Taita Taveta">Taita Taveta</option>
                  <option value="Tana River">Tana River</option>
                  <option value="Tharaka Nithi">Tharaka Nithi</option>
                  <option value="Trans Nzoia">Trans Nzoia</option>
                  <option value="Turkana">Turkana</option>
                  <option value="Uasin Gishu">Uasin Gishu</option>
                  <option value="Vihiga">Vihiga</option>
                  <option value="Wajir">Wajir</option>
                  <option value="West Pokot">West Pokot</option>
                </select>
              </div>
            </div>
            <!-- Form Row 2 -->
            <div class="form-row">
              <div class="col-md-6 mb-3">
                <label class="sr-only">Bedrooms</label>
                <select name="bedrooms" class="form-control">
                  <option selected="true" disabled="disabled">
                    Bedrooms (All)
                  </option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                  <option value="6">6</option>
                  <option value="7">7</option>
                  <option value="8">8</option>
                  <option value="9">9</option>
                  <option value="10">10</option>
                </select>
              </div>
              <div class="col-md-6 mb-3">
                <select name="price" class="form-control" id="type">
                  <option selected="true" disabled="disabled">
                    Max Price (Any)
                  </option>
                  <option value="100000">Ksh.100,000</option>
                  <option value="200000">Ksh.200,000</option>
                  <option value="300000">Ksh.300,000</option>
                  <option value="400000">Ksh.400,000</option>
                  <option value="500000">Ksh.500,000</option>
                  <option value="600000">Ksh.600,000</option>
                  <option value="700000">Ksh.700,000</option>
                  <option value="800000">Ksh.800,000</option>
                  <option value="900000">Ksh.900,000</option>
                  <option value="1000000">Ksh.1M+</option>
                </select>
              </div>
            </div>
            <button class="btn btn-secondary btn-block mt-4" type="submit">
              Submit form
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Listings -->
<section id="listings" class="py-5">
  <div class="container">
    <h3 class="text-center mb-3">Latest Listings</h3>
    <div class="row">
      <!-- Listings -->
      {% for listing in listings %}
      <div class="col-md-6 col-lg-4 mb-4">
        <div class="card listing-preview">
          <img class="card-img-top" src="{{ listing.thumb_nail.url }}" alt="" />
          <div class="card-img-overlay">
            <h2>
              <span class="badge badge-secondary text-white">
                Ksh{{ listing.price }}</span
              >
            </h2>
          </div>
          <div class="card-body">
            <div class="listing-heading text-center">
              <h4 class="text-primary">{{ listing.title }}</h4>
              <p>
                <i class="fas fa-map-marker text-secondary"></i> {{ listing.city
                }} {{ listing.state }}, {{ listing.zipcode }}
              </p>
            </div>
            <hr />
            <div class="row py-2 text-secondary">
              <div class="col-6">
                <i class="fas fa-th-large"></i> Sqft: {{ listing.sqft }}
              </div>
              <div class="col-6">
                <i class="fas fa-car"></i> Garage: {{ listing.garage }}
              </div>
            </div>
            <div class="row py-2 text-secondary">
              <div class="col-6">
                <i class="fas fa-bed"></i> Bedrooms: {{ listing.bedrooms }}
              </div>
              <div class="col-6">
                <i class="fas fa-bath"></i> Bathrooms: {{ listing.bathrooms }}
              </div>
            </div>
            <hr />
            <div class="row py-2 text-secondary">
              <div class="col-6"><i class="fas fa-user"></i> Elizabeth Mwangi</div>
            </div>
            <div class="row text-secondary pb-2">
              <div class="col-6">
                <i class="fas fa-clock"></i> {{ listing.list_date | timesince }}
              </div>
            </div>
            <hr />
            <a
              href="{{ listing.get_absolute_url }}"
              class="btn btn-primary btn-block"
              >More Info</a
            >
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</section>


<section id="services" class="py-5 bg-secondary text-white">
  <div class="container">
    <div class="row text-center">
      <div class="col-md-4">
        <i class="fas fa-comment fa-4x mr-4"></i>
        <hr />
        <h3>Consulting Services</h3>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Incidunt,
          debitis nam! Repudiandae, provident iste consequatur hic dignissimos
          ratione ea quae.
        </p>
      </div>
      <div class="col-md-4">
        <i class="fas fa-home fa-4x mr-4"></i>
        <hr />
        <h3>Property Management</h3>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Incidunt,
          debitis nam! Repudiandae, provident iste consequatur hic dignissimos
          ratione ea quae.
        </p>
      </div>
      <div class="col-md-4">
        <i class="fas fa-suitcase fa-4x mr-4"></i>
        <hr />
        <h3>Renting & Selling</h3>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Incidunt,
          debitis nam! Repudiandae, provident iste consequatur hic dignissimos
          ratione ea quae.
        </p>
      </div>
    </div>
  </div>
</section>

<!-- Chatbot Container -->
<div id="chatbot-container">
  <!-- Chatbot Toggle Button -->
  <button id="chatbot-toggle-btn">
      <img src="{% static 'img/chatbot.png' %}" alt="Chatbot Icon" style="max-width: 70px; max-height: 50px;">
  </button>
  </button>

  <!-- Chatbot Widget -->
  <div id="chatbot-widget">
      <!-- Chatbot Header -->
      <div id="chatbot-header">
          <span>Chatbot</span>
          <button id="chatbot-close-btn">×</button>
      </div>

      <!-- Chatbot Messages -->
      <div id="chatbot-messages"></div>

      <!-- Chatbot Input -->
      <input type="text" id="chatbot-input" placeholder="Type your message..." />
      <button id="chatbot-send-btn">Send</button>
  </div>
</div>

<!-- Include jQuery (You can download it or use a CDN) -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<!-- Include the script for Chatbot functionality -->
<script>
  // Replace 'YOUR_DIALOGFLOW_API_KEY' with your actual Dialogflow API key
  const dialogflowApiKey = 'YOUR_DIALOGFLOW_API_KEY';

  // Function to send a message to Dialogflow and receive a response
  function sendMessageToDialogflow(message) {
      // Implement logic to communicate with Dialogflow using the API key
      // This can be done through AJAX or any library you prefer
      // For simplicity, this example doesn't include the actual implementation
      // Instead, it just returns a placeholder response
      return Promise.resolve('Dialogflow Response: ' + message);
  }

  // Function to add a message to the chatbot widget
  function addMessageToChatbot(message, isUser = false) {
      const messageContainer = $('#chatbot-messages');
      const messageClass = isUser ? 'user-message' : 'bot-message';
      messageContainer.append(`<div class="${messageClass}">${message}</div>`);
      messageContainer.scrollTop(messageContainer[0].scrollHeight);
  }

  // Toggle the chatbot widget
  $('#chatbot-toggle-btn').click(function () {
      $('#chatbot-widget').toggle();
  });

  // Close the chatbot widget
  $('#chatbot-close-btn').click(function () {
      $('#chatbot-widget').hide();
  });

  // Handle sending messages
  $('#chatbot-send-btn').click(function () {
      const userMessage = $('#chatbot-input').val();
      if (userMessage) {
          addMessageToChatbot(userMessage, true);

          // Send the user message to Dialogflow and get a response
          sendMessageToDialogflow(userMessage)
              .then(response => addMessageToChatbot(response));

          // Clear the input field
          $('#chatbot-input').val('');
      }
  });
</script>

<style>
  /* Add this style in the head or your style file to customize the appearance */
  #chatbot-container {
      position: fixed;
      bottom: 0;
      right: 0;
      background-color: green;
      color: white;
      border-radius: 20px 0 0 0;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
  }

  #chatbot-toggle-btn {
      background-color: green;
      border: none;
      padding: 10px;
      cursor: pointer;
  }

  #chatbot-toggle-btn img {
      max-width: 24px; /* Adjust the size as needed */
      max-height: 24px; /* Adjust the size as needed */
  }

  #chatbot-widget {
      display: none;
      flex-direction: column;
      align-items: flex-end;
      max-width: 300px;
      padding: 10px;
      border-radius: 10px;
  }

  #chatbot-header {
      display: flex;
      justify-content: space-between;
      width: 100%;
      padding: 5px 0;
      border-bottom: 1px solid white;
  }

  #chatbot-messages {
      max-height: 200px;
      overflow-y: auto;
      margin-bottom: 10px;
  }

  .user-message,
  .bot-message {
      padding: 5px;
      margin-bottom: 5px;
      border-radius: 5px;
  }

  .user-message {
      background-color: #eee;
      align-self: flex-end;
  }

  .bot-message {
      background-color: white;
  }

  #chatbot-input {
      width: calc(100% - 70px);
      margin-right: 10px;
      padding: 5px;
      border: 1px solid white;
      border-radius: 5px;
  }

  #chatbot-send-btn {
      background-color: green;
      color: white;
      border: none;
      padding: 5px;
      border-radius: 5px;
      cursor: pointer;
  }
</style>

{% endblock %}
